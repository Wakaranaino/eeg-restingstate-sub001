# EEG Resting-State Analysis: Multi-Subject ICA, PSD, and Bandpower Topomap

This repository provides a fully automated MATLAB pipeline for preprocessing and analyzing resting-state EEG data across multiple subjects using EEGLAB. It was originally developed for [OpenNeuro dataset: ds004504](https://doi.org/10.18112/openneuro.ds004504.v1.0.8) and has been generalized from single-subject scripts to a multi-subject batch framework.

---

## Overview

### Goal
Extract clean spectral features (Theta, Alpha, Beta) from EEG recordings and visualize scalp-wide distributions — supporting multi-subject normalization, quality control (QC), and group-level comparison.

---

### Group-Level Statistical Analysis *(New)*

**Script**: `eeg_group_stats_v1.m`  
Performs group-level bandpower comparison across Control, AD, and FTD groups:

- Loads merged subject QC data (`qc_summary_all_subjects.csv`) + labels (`participants.tsv`)
- One-way ANOVA per band (Theta, Alpha, Beta)
- Post-hoc tests with significance stars
- Pairwise Cohen’s d effect sizes
- Summary statistics table with ANOVA p, post-hoc results, and max effect size
- Group bar plots with error bars + significance stars
- Scalp topomaps averaged by group × band

---

### Preprocessing Pipeline
Script: `eeg_preprocessing_multisub_v2_1.m`

1. Load raw `.set` EEG dataset  
2. Artifact reduction via `clean_rawdata()` (ASR)  
3. Low-pass filter at 40 Hz  
4. Average reference and **interpolate missing channels** 
5. Run ICA (Infomax)  
6. IC classification with ICLabel  
7. Auto-reject artifactual ICs (e.g., eye, muscle)  
8. Compute PSD via `spectopo()`  
9. Plot scalp maps via `pop_spectopo()`  
10. Normalize bandpower per subject  
11. Log ICs rejected, bandpower, and interpolated channels (CVS + TXT + MAT)  
12. Save all outputs under `outputs/` organized per subject

---

### What’s New in Version 2.1 (June 9, 2025)

- Channel interpolation (spherical)
- Logs interpolated channels per subject
- Compatible with group-level topomap

---

## Files Included

| Folder/File                          | Description                                                  |
|--------------------------------------|--------------------------------------------------------------|
| `eeg_preprocessing_multisub_v2_1.m`  | Preprocessing pipeline for multiple subjects                 |
| `eeg_group_stats_v1.m`               | Group-level stats & topomap script                           |
| `check_subject_integrity.m`          | Utility script to verify preprocessing outputs               |
| `outputs/`                           | Output directory (see below for contents)                    |

### outputs/ structure:

- `outputs/sub-XXX/` — Individual subject folders  
  - `*_v2.1_cleaned_final.set` — Cleaned EEG (one-file format)  
  - `*_bandpower_matrix.csv`, `*_psd_matrix.csv` — PSD + band features  
  - `*_qc_log.txt`, `*_summary.mat`, `*_interpolation_log.mat` — QC and interpolation logs  
  - `*_topomap_summary.png` — Per-subject scalp maps  

- `outputs/stats/` — Group-level stats  
  - `group_bandpower_means.csv` — Mean ± SEM by group  
  - `anova_bandpower_pvalues.csv` — ANOVA results per band  
  - `posthoc_all_bands.csv` — Pairwise post-hoc comparisons  
  - `effect_size_all_pairs.csv` — Cohen’s d table  
  - `bandpower_stats_summary.csv` — Summary table (band, p, sig, max d)  
  - `group_bandpower_comparison.png/pdf` — Bar plot with significance  
  - `topomap_group_[group].png` — Averaged scalp maps per group  

> Only a few `.set` files (e.g., `sub-001`, `sub-004`) are included as examples.  
> Raw data from OpenNeuro should be downloaded to reproduce full outputs.

---

## Sample Output

![Topomap Summary](https://github.com/Wakaranaino/eeg-restingstate-sub001/blob/main/outputs/sub-001/sub-001_v2.1_topomap_summary.png)  
*Topographic maps of Theta, Alpha, Beta power, plus PSD distribution*

---

## Reproducibility

The pipeline is reproducible with:
- Raw EEG files from OpenNeuro `ds004504`
- Scripts in this repo (`v2.1` preprocessing + `v1.0` stats)

Suggested test cases:
- AD: sub-001 to sub-004  
- CN: sub-037 to sub-040  
- FTD: sub-066 to sub-069

---

## Requirements

- MATLAB R2022a or later  
- [EEGLAB toolbox](https://sccn.ucsd.edu/eeglab/index.php)  
- Signal Processing Toolbox  
- `clean_rawdata()` EEGLAB plugin (optional but recommended)  

---

## Versioning

### Group-Level Stats Scripts
- **v1.0** – Jun 10, 2025  
  First release of group-level EEG stats:  
  - ANOVA, post-hoc (with stars)  
  - Cohen’s d  
  - Topomaps + summary tables  

### Preprocessing Scripts
- **v2.1** – Jun 9, 2025  
  Interpolation added + per-channel QC logs  
- **v2.0** – Jun 7, 2025  
  Modular preprocessing + normalized power output  
- **v1.3** – Jun 6, 2025  
  Scalable loop + subject skipping  
- **v1.0–1.2** – Initial development (June 1–5, 2025)

---

## Dataset Attribution

> EEG recordings from: Alzheimer’s, Frontotemporal Dementia, and Healthy controls  
> Andreas Miltiadous and Katerina D. Tzimourta and Theodora Afrantou and Panagiotis Ioannidis and Nikolaos Grigoriadis and Dimitrios G. Tsalikakis and Pantelis Angelidis and Markos G. Tsipouras and Evripidis Glavas and Nikolaos Giannakeas and Alexandros T. Tzallas (2024). A dataset of EEG recordings from: Alzheimer's disease, Frontotemporal dementia and Healthy subjects. OpenNeuro. [Dataset] doi: doi:10.18112/openneuro.ds004504.v1.0.8

---

## License

MIT License — open for academic and research reuse with credit.

---

## Contact

For questions or collaboration, feel free to contact: `vt.gao@asu.edu`  
[GitHub Profile](https://github.com/Wakaranaino)

