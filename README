# EEG Resting-State Analysis: Multi-Subject ICA, PSD, and Bandpower Topomap

This repository provides a fully automated MATLAB pipeline for preprocessing and analyzing resting-state EEG data across multiple subjects using EEGLAB. It was originally developed for [OpenNeuro dataset: ds004504](https://doi.org/10.18112/openneuro.ds004504.v1.0.8) and has been generalized from single-subject scripts to a multi-subject batch framework.

## Overview

**Goal**:  Extract clean spectral features (Theta, Alpha, Beta) from EEG recordings and visualize scalp-wide distributions, while supporting multi-subject normalization, quality control (QC), and group-level summaries.

**Pipeline**:
1. Load .set EEG dataset
2. Automated artifact reduction via clean_rawdata()
3. Apply low-pass filter at 40 Hz
4. Re-reference to average
5. Run ICA (Infomax)
6. Component classification with ICLabel
7. Auto-reject artifactual components (e.g., blinks, muscle, ECG)
8. Compute PSD matrix via spectopo()
9. Generate PSD plots and scalp maps via pop_spectopo()
10. Normalize bandpower within each subject (proportional to total power)
11. Log QC metrics (ICs rejected, bandpower means) to a master CSV
12. Save all outputs to organized subject-level folders under /outputs/

***New in Version 2.0***
- Multi-subject loop (batch-ready)
- Subject-level modular outputs
- Normalized bandpower for across-subject comparison
- Group-level QC summary in qc_summary_all_subjects.csv
- Ready for group analysis (e.g., healthy vs. AD)
- Includes integrity checks (NaNs, bad channels)
- Can integrate with external demographic files like participants.tsv

## Files Included

| Folder/File                               | Description                                         |
|------------------------------------|-----------------------------------------------------|
| eeg_analysis_multisub_v2_0.m       | Multi-subject MATLAB analysis script                |
| check_subject_integrity.m          | script to verify output consistency                 |
| README.md                          | This documentation                                  |
| outputs/                           | Contains all per-subject outputs listed below       |

| sub-XXX_cleaned_final_v1.3.set     | Cleaned EEGLAB datasets (auto-generated)            | 
| _psd_matrix_v1.3.csv               | PSD matrix (all channels) via spectopo()            |
| _bandpower_matrix_v1.3.csv         | Theta, Alpha, Beta power by channel                 |
| _qc_log_v1.3.txt                   | Per-subject QC log (ICs rejected + bandpower means) |
| _summary_v1.3.mat                  | Saved variables for batch/group QC analysis         |
| _topomap_summary_v1.3.png          | Combined figure (PSD + 3 band topomaps)             |
| qc_summary_all_subjects.csv        | Master log of normalized bandpower + ICs rejected   |


> Raw EEG `.set` file not included due to size. Tested on OpenNeuro sub-001 (eyes-closed).

## Sample Output

![Topomap Summary](https://github.com/Wakaranaino/eeg-restingstate-sub001/blob/main/sub-001_v1.3_topomap_summary.png)  
*Topographic maps of Theta, Alpha, and Beta bandpower, plus PSD distribution*

## Requirements

- MATLAB R2022a or later
- [EEGLAB toolbox](https://sccn.ucsd.edu/eeglab/index.php)
- Signal Processing Toolbox (for `pwelch`, `bandpower`)
- Optional: clean_rawdata() plugin (EEGLAB plugin manager)

## Citation

If you use this script or adapt it for academic work, feel free to credit:

> Vermut Gao, "EEG Resting-State Pipeline – sub001 Analysis", 2025  
> [GitHub Repository Link](https://github.com/Wakaranaino/eeg-restingstate-sub001)

## Contact

For questions or collaboration, reach out via GitHub or email: `vt.gao@asu.edu`

## Dataset Attribution

This script uses EEG data from the following OpenNeuro dataset:

Andreas Miltiadous, Katerina D. Tzimourta, Theodora Afrantou, Panagiotis Ioannidis, Nikolaos Grigoriadis, Dimitrios G. Tsalikakis, Pantelis Angelidis, Markos G. Tsipouras, Evripidis Glavas, Nikolaos Giannakeas, Alexandros T. Tzallas (2024).
A dataset of EEG recordings from: Alzheimer’s disease, Frontotemporal dementia and Healthy subjects.
OpenNeuro. [Dataset] https://doi.org/10.18112/openneuro.ds004504.v1.0.8

## Version

- v2.0 – Jun 7, 2025
  Multi-subject loop with modular output paths
  - Added normalized bandpower + QC master CSV
  - Ready for group-level comparison and visualization
  - Includes subject integrity checker
- v1.3 – Jun 6, 2025:  
  Refactored for multi-subject scaling and reusability:
  - Added load_cleaned_set to skip preprocessing on reruns
  - Standardized path handling and parameter setup
  - Modularized bandpower logic (band_defs, bandpower_struct)
  - Automated QC logging (.txt, .mat, master .csv)
  - Adaptive plotting for topomaps and summaries
- v1.2 – Jun 3, 2025:  
  Major upgrade: research-level `clean_rawdata()`, added `spectopo()` for full PSD matrix, organized output folder
- v1.1 – Jun 2, 2025:  
  Fully automated version with `clean_rawdata()` + ICLabel rejection
- v1.0 – Initial release (Jun 1, 2025)

## License

This code is released under the MIT License. Feel free to modify and reuse with proper attribution.

